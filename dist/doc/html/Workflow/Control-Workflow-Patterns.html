<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Control.Workflow.Patterns</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Control-Workflow-Patterns.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">Workflow-0.7.0.0: Monadic transformer for persistence in threads. and workflow patterns</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Control.Workflow.Patterns</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Low level combinators
</a></li><li><a href="#g:2">High level conbinators
</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module contains monadic combinators that express some workflow patterns.
see the docAprobal.hs example included in the package
</p><p>EXAMPLE:
</p><p>This fragment below describes the approbal procedure of a document.
First the document reference is sent to a list of bosses trough a queue.
ithey return a boolean in a  return queue ( askUser)
the booleans are summed up according with a monoid instance (sumUp)
</p><p>if the resullt is false, the correctWF workflow is executed
If the result is True, the pipeline continues to the next stage  (checkValidated)
</p><p>the next stage is the same process with a new list of users (superbosses).
There is a timeout of seven days. The result of the users that voted is summed
up according with the same monoid instance
</p><p>if the result is true the document is added to the persistent list of approbed documents
if the result is false, the document is added to the persistent list of rejectec documents (<code>checlkValidated1</code>)
</p><p>The program can be interrupted at any moment. The Workflow monad will restartWorkflows
it at the point where it was interrupted.
</p><p>This example uses queues from <a href="Data-Persistent-Queue.html">Data.Persistent.Queue</a>
</p><pre>docApprobal :: Document -&gt; Workflow IO ()
docApprobal doc =  <code>getWFRef</code> &gt;&gt;= docApprobal1

docApprobal1 rdoc=
    return True &gt;&gt;=
    log &quot;requesting approbal from bosses&quot; &gt;&gt;=
    <code><a href="Control-Workflow-Patterns.html#v:sumUp">sumUp</a></code> 0 (map (askUser doc rdoc) bosses)  &gt;&gt;=
    checkValidated &gt;&gt;=
    log &quot;requesting approbal from superbosses or timeout&quot;  &gt;&gt;=
    <code><a href="Control-Workflow-Patterns.html#v:sumUp">sumUp</a></code> (7*60*60*24) (map(askUser doc rdoc) superbosses) &gt;&gt;=
    checkValidated1

askUser _ _ user False = return False
askUser doc rdoc user  True =  do
      <code><a href="Control-Workflow.html#v:step">step</a></code> $ <code>push</code> (quser user) rdoc
      <code><a href="Control-Workflow.html#v:logWF">logWF</a></code> (&quot;wait for any response from the user: &quot; ++ user)
      <code><a href="Control-Workflow.html#v:step">step</a></code> . <code>pop</code> $ qdocApprobal (title doc)

log txt x = <code><a href="Control-Workflow.html#v:logWF">logWF</a></code> txt &gt;&gt; return x

checkValidated :: Bool -&gt; <code><a href="Control-Workflow.html#t:Workflow">Workflow</a></code> IO Bool
checkValidated  val =
      case val of
        False -&gt; correctWF (title doc) rdoc &gt;&gt; return False
        _     -&gt; return True

checkValidated1 :: Bool -&gt; Workflow IO ()
checkValidated1 val = step $ do
      case  val of
        False -&gt; <code>push</code> qrejected doc
        _     -&gt; <code>push</code> qapproved doc
      mapM (u -&gt;deleteFromQueue (quser u) rdoc) superbosses</pre></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:split">split</a> :: (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> b, <a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> b, <a href="Control-Workflow.html#t:HasFork">HasFork</a> io, MonadCatchIO io) =&gt; [a -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io b] -&gt; a -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io [ActionWF b]</li><li class="src short"><a href="#v:merge">merge</a> :: (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib\extralibs\doc\transformers-0.3.0.0\html/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> io, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> b, <a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> a, <a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> b) =&gt; ([a] -&gt; io b) -&gt; [ActionWF a] -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io b</li><li class="src short"><a href="#v:select">select</a> :: (<a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> a, <a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> [a], <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a, <a href="Control-Workflow.html#t:HasFork">HasFork</a> io, MonadCatchIO io) =&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; (a -&gt; io <a href="Control-Workflow-Patterns.html#t:Select">Select</a>) -&gt; [ActionWF a] -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io [a]</li><li class="src short"><a href="#v:vote">vote</a> :: (<a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> b, <a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> [b], <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> b, <a href="Control-Workflow.html#t:HasFork">HasFork</a> io, MonadCatchIO io) =&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; [a -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io b] -&gt; ([b] -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io c) -&gt; a -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io c</li><li class="src short"><a href="#v:sumUp">sumUp</a> :: (<a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> b, <a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> [b], <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> b, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Monoid.html#t:Monoid">Monoid</a> b, <a href="Control-Workflow.html#t:HasFork">HasFork</a> io, MonadCatchIO io) =&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; [a -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io b] -&gt; a -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io b</li><li class="src short"><span class="keyword">data</span>  <a href="#t:Select">Select</a> <ul class="subs"><li>= <a href="#v:Select">Select</a>  </li><li>| <a href="#v:Discard">Discard</a>  </li><li>| <a href="#v:FinishDiscard">FinishDiscard</a>  </li><li>| <a href="#v:FinishSelect">FinishSelect</a>  </li></ul></li></ul></div><div id="interface"><h1 id="g:1">Low level combinators
</h1><div class="top"><p class="src"><a name="v:split" class="def">split</a> :: (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> b, <a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> b, <a href="Control-Workflow.html#t:HasFork">HasFork</a> io, MonadCatchIO io) =&gt; [a -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io b] -&gt; a -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io [ActionWF b]</p><div class="doc"><p>spawn a list of independent workflow <code>actions</code> with a seed value <code>a</code>
 The results are reduced by <code><a href="Control-Workflow-Patterns.html#v:merge">merge</a></code> or <code><a href="Control-Workflow-Patterns.html#v:select">select</a></code>
</p></div></div><div class="top"><p class="src"><a name="v:merge" class="def">merge</a> :: (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib\extralibs\doc\transformers-0.3.0.0\html/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> io, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> b, <a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> a, <a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> b) =&gt; ([a] -&gt; io b) -&gt; [ActionWF a] -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io b</p><div class="doc"><p>wait for the results and apply the cond to produce a single output in the Workflow monad
</p></div></div><div class="top"><p class="src"><a name="v:select" class="def">select</a> :: (<a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> a, <a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> [a], <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a, <a href="Control-Workflow.html#t:HasFork">HasFork</a> io, MonadCatchIO io) =&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; (a -&gt; io <a href="Control-Workflow-Patterns.html#t:Select">Select</a>) -&gt; [ActionWF a] -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io [a]</p><div class="doc"><p>select the outputs of the workflows produced by <code><a href="Control-Workflow-Patterns.html#v:split">split</a></code> constrained within a timeout.
 The check filter, can select , discard or finish the entire computation before
 the timeout is reached. When the computation finalizes, it kill all
 the pending workflows and return the list of selected outputs
 the timeout is in seconds and is no limited to a single execution, so it can proceed for years.
</p><p>This is necessary for the modelization of real-life institutional cycles such are political elections
 A timeout of 0 means no timeout.
</p></div></div><h1 id="g:2">High level conbinators
</h1><div class="top"><p class="src"><a name="v:vote" class="def">vote</a> :: (<a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> b, <a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> [b], <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> b, <a href="Control-Workflow.html#t:HasFork">HasFork</a> io, MonadCatchIO io) =&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; [a -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io b] -&gt; ([b] -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io c) -&gt; a -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io c</p><div class="doc"><p>spawn a list of workflows and reduces the results according with the <code>comp</code> parameter within a given timeout
</p><pre>
   vote timeout actions comp x=
        split actions x &gt;&gt;= select timeout (const $ return Select)  &gt;&gt;=  comp
</pre></div></div><div class="top"><p class="src"><a name="v:sumUp" class="def">sumUp</a> :: (<a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> b, <a href="C:\Users\agocorona\AppData\Roaming\cabal\doc\RefSerialize-0.2.8.1\html/Data-RefSerialize.html#t:Serialize">Serialize</a> [b], <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> b, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Monoid.html#t:Monoid">Monoid</a> b, <a href="Control-Workflow.html#t:HasFork">HasFork</a> io, MonadCatchIO io) =&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; [a -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io b] -&gt; a -&gt; <a href="Control-Workflow.html#t:Workflow">Workflow</a> io b</p><div class="doc"><p>sum the outputs of a list of workflows  according with its monoid definition
</p><pre> sumUp timeout actions = vote timeout actions (return . mconcat)</pre></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Select" class="def">Select</a>  </p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Select" class="def">Select</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:Discard" class="def">Discard</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:FinishDiscard" class="def">FinishDiscard</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:FinishSelect" class="def">FinishSelect</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:Select" class="caption collapser" onclick="toggleSection('i:Select')">Instances</p><div id="section.i:Select" class="show"><table><tr><td class="src"><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Text-Read.html#t:Read">Read</a> <a href="Control-Workflow-Patterns.html#t:Select">Select</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Text-Show.html#t:Show">Show</a> <a href="Control-Workflow-Patterns.html#t:Select">Select</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> <a href="Control-Workflow-Patterns.html#t:Select">Select</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Control-Exception-Base.html#t:Exception">Exception</a> <a href="Control-Workflow-Patterns.html#t:Select">Select</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>